{% extends 'main_app/admin_base.html' %}

{% block title %}Student Records | Hogwarts University{% endblock %}

{% block content %}
<div class="p-8">
    <div class="flex items-center justify-between mb-6">
        <div>
            <h2 class="text-2xl font-bold text-gray-800 flex items-center">
                <i class="fas fa-users mr-3 text-gray-600"></i> Student Management
            </h2>
            <p class="text-gray-600">Manage and view all student information</p>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-md overflow-hidden border border-gray-200">
        <div class="bg-gray-800 text-white px-6 py-4 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <h5 class="font-bold text-lg flex items-center">
                <i class="fas fa-user-graduate mr-2"></i> All Students
            </h5>
            <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                <div class="relative w-full md:w-64">
                    <input type="text" id="studentSearch" 
                           class="w-full bg-gray-700 border border-gray-600 text-white placeholder-gray-300 rounded-lg px-4 py-2 pl-10 focus:ring-2 focus:ring-gray-500 focus:border-gray-500" 
                           placeholder="Search students...">
                    <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                </div>
                <select id="genderFilter" 
                        class="bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 focus:ring-2 focus:ring-gray-500 focus:border-gray-500">
                    <option value="">All Genders</option>
                    {% for gender in gender_choices %}
                    <option value="{{ gender.0 }}" {% if selected_gender == gender.0 %}selected{% endif %}>{{ gender.1 }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="overflow-x-auto" style="max-height: 70vh;">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 sticky top-0">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-id-card mr-1"></i> ID
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-user mr-1"></i> Name
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-venus-mars mr-1"></i> Gender
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-envelope mr-1"></i> Email
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-phone mr-1"></i> Contact
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-birthday-cake mr-1"></i> Birthdate
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-graduation-cap mr-1"></i> Program
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-home mr-1"></i> Address
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-city mr-1"></i> City
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                            <i class="fas fa-cog mr-1"></i> Actions
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for student in students %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                            {{ student.stud_id }}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-800">
                            {{ student.stud_lname }}, {{ student.stud_fname }} 
                            {% if student.stud_mname %}{{ student.stud_mname|first }}.{% endif %}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            {{ student.get_stud_gender_display }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            {{ student.stud_email }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            {{ student.stud_contact_num }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            {{ student.stud_dob|date:"M d, Y" }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            {{ student.stud_program }}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-700">
                            {{ student.stud_address|truncatechars:20 }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">
                            {{ student.stud_city_add }}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <div class="flex space-x-2">
                                <a href="{% url 'view_academic_history' student.stud_id %}" 
                                   class="text-blue-600 hover:text-blue-800" title="View Academic History">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="{% url 'select_enrollment_for_remarks' student.stud_id %}" 
                                   class="text-gray-600 hover:text-gray-800" title="Academic Remarks">
                                    <i class="fas fa-pencil-alt"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Enhanced search functionality
    document.getElementById('studentSearch').addEventListener('input', function() {
        const searchValue = this.value.toLowerCase();
        const rows = document.querySelectorAll('tbody tr');
        
        rows.forEach(row => {
            const cells = row.querySelectorAll('td');
            let rowMatches = false;
            
            cells.forEach(cell => {
                if (cell.textContent.toLowerCase().includes(searchValue)) {
                    rowMatches = true;
                }
            });
            
            row.style.display = rowMatches ? '' : 'none';
        });
    });

    // Gender filter functionality
    document.getElementById('genderFilter').addEventListener('change', function() {
        const genderValue = this.value;
        if (genderValue) {
            window.location.href = `?gender=${genderValue}`;
        } else {
            window.location.href = '?';
        }
    });
</script>
{% endblock %}